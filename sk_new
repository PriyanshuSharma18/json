# writer_service.py (bottom part)

from fastapi import HTTPException
import traceback

@app.post("/invoke", response_model=AgentResponse)
async def invoke_writer(payload: AgentRequest):
    print(f"[WriterService] Received request: {payload.input}")
    try:
        output = await writer_agent.run(payload.input)
        print(f"[WriterService] Generated output: {output}")
        return AgentResponse(agent="writer", output=output)
    except Exception as e:
        # Print full stacktrace in the writer terminal
        print("[WriterService] ERROR while generating email:")
        traceback.print_exc()
        # Bubble up message so host can see it
        raise HTTPException(status_code=500, detail=str(e))


@app.get("/health")
async def health_check():
    return {"status": "healthy", "service": "writer"}
